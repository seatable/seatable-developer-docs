# Common questions (Python)

??? question "How to make the script support both local and cloud run"

    ## How to make the script support both local and cloud run

    __Flexible authorization__

    When the script runs in the cloud, it will provide a context object, which contains the server URL auto generated by the system and the API token of base. If you run the script in local, you need to manually specify these two variables; the API token can be generated in the drop-down menu "Advanced -> API Token" of the table.

    Use the following method to make the script support both local and cloud run

    ```
    from seatable_api import Base, context

    server_url = context.server_url or 'https://cloud.seatable.io'
    api_token = context.api_token or 'c3c75dca2c369848455a39f4436147639cf02b2d'


    base = Base(api_token, server_url)
    base.auth()
    ```

    __Dependencies that need to be installed to run the script local__

    The script need to install `seatable-api` when run in local.

    ```
    pip3 install seatable-api
    ```

    Additional requirements are:

    - Python >= 3.5
    - requests
    - socketIO-client-nexus

??? question "List of libraries supported in the cloud environment"

    ## List of libraries supported in the cloud environment

    In the cloud environment, Python scripts run within a Docker container. This container comes pre-configured with a set of Python libraries that can be imported and used in your scripts. If you require libraries not included in this set, please contact our support team. Otherwise, scripts using unsupported libraries can only be executed locally.

    __Python Standard Library__

    The cloud environment currently utilizes **Python 3.12**. This version supports all modules in the Python 3.12 standard library. Common built-in libraries such as `os`, `sys`, `datetime`, and others are readily available for use in your scripts.

    __Third-Party Libraries__

    In addition to the standard library, we've included several popular third-party packages to enhance your scripting capabilities:

    - [seatable-api](https://pypi.org/project/seatable-api/): Official SeaTable Python API
    - [dateutils](https://pypi.org/project/dateutils/): Extensions to Python's datetime module
    - [requests](https://pypi.org/project/requests/): HTTP library for Python
    - [pyOpenSSL](https://pypi.org/project/pyOpenSSL/): Python wrapper for OpenSSL
    - [Pillow](https://pypi.org/project/Pillow/): Python Imaging Library (Fork) with support for [HEIF images](https://pypi.org/project/pillow-heif/)
    - [python-barcode](https://pypi.org/project/python-barcode/): Barcode generator
    - [qrcode](https://pypi.org/project/qrcode/): QR Code generator
    - [pandas](https://pypi.org/project/pandas/): Data manipulation and analysis library
    - [numpy](https://pypi.org/project/numpy/): Fundamental package for scientific computing
    - [openai](https://pypi.org/project/openai/): OpenAI API client library
    - [ldap3](https://pypi.org/project/ldap3/): LDAP v3 client library
    - [pydantic](https://pypi.org/project/pydantic/): Data validation and settings management using Python type annotations
    - [httpx](https://pypi.org/project/httpx/): A next-generation HTTP client for Python
    - [PyJWT](https://pypi.org/project/PyJWT/): JSON Web Token implementation in Python
    - [python-socketio](https://pypi.org/project/python-socketio/): Python implementation of the Socket.IO realtime server
    - [scipy](https://pypi.org/project/scipy/): Fundamental algorithms for scientific computing in Python
    - [PyPDF](https://pypi.org/project/pypdf/): PDF toolkit for Python
    - [pdfmerge](https://pypi.org/project/pdfmerge/): Merge PDF files

    This list is not exhaustive. For a complete, up-to-date list of available third-party packages, you can run the following Python script in your SeaTable environment:

    ```python
    import importlib.metadata

    # List all installed packages
    installed_packages = importlib.metadata.distributions()

    # Print package names
    for package in installed_packages:
      print(package.metadata['Name'])
    ```

??? question "Install and use custom python libraries"

    ## Install and use custom python libraries

    - The python libraries in SeaTable Cloud can not be changed.
    - If you run your own SeaTable Server it is possible to install your own libraries.

??? question "Printing complex elements (dicts, tables, arrays of rows) is sometimes difficult to read"

    ## Printing complex elements is sometimes difficult to read

    Do not hesitate to run your code in a Python IDE which could have specific features for data visualization (don't forget you won't be able to rely on context to provide `api_token` and `server_url`, see first question for dual run syntax). You could also use the `json` library to make the output of complex objects easier to read:

    ```python
    import json # (1)!
    from seatable_api import Base,context
    base = Base(context.api_token,context.server_url)
    base.auth()

    print(json.dumps(base.get_metadata(), indent=' ')) # (2)!
    ```

    1. Import the json library

    2. Print `json.dumps(object, indent='  ')` instead of just printing object. You have to explicitly specify the indent character (which is not a classic space character) as the output window of SeaTable's script editor actually trims indent spaces.

??? question "How to deal with more than 1000 rows at once with batch operations?"

    ## Dealing with more than 1000 rows at once with batch operations

    As presented in the [API Reference](https://api.seatable.com/reference/limits), batch operations such as `base.batch_append_rows`, `base.batch_update_rows`, `base.batch_delete_rows` or `base.batch_update_links` have a maximum number of 1000 rows. To deal with a higher number of rows, you could:

    - Use an `INSERT`, `UPDATE` or `DELETE` [SQL query](../sql/reference.md#supported-sql-syntax) that can operate on an unlimited number of rows

    - Use a `while` loop to split you operation into 1000-rows chunks for example (however this won't exactly be a single operation anymore):

    ```python
    from seatable_api import Base, context

    base = Base(context.api_token, context.server_url)
    base.auth()

    # You want to batch append new_rows which is more than 1000-rows long
    while len(new_rows)>0 :
        end = min(1000,len(new_rows))
        rows_chunk = new_rows[:end]
        print(f"{rows_chunk[0]['Name']} > {rows_chunk[-1]['Name']}")
        base.batch_append_rows("Table1", rows_chunk)
        new_rows = new_rows[end:len(new_rows)]
    ```

    To [batch update links](./objects/links.md#update-links), the loop will be slightly more complex as you'll have to deal with `other_rows_ids_map` as well


